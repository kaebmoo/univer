# ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Univer

## üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£

### ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏ä‡πâ Excel ‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:
- ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Excel
- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, ‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™, ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à, etc.)
- Export ‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠
- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ö‡∏ô browser (‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà save ‡∏Å‡∏•‡∏±‡∏ö database)

### Technology Stack
- **Frontend**: React + TypeScript + Vite + Univer
- **Backend**: Python + FastAPI + Pandas
- **Authentication**: Email Domain + OTP
- **MCP Server**: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- **Data Source**: CSV files

---

## üèóÔ∏è ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏∞‡∏ö‡∏ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         User Browser                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  React App (Frontend)                                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Authentication UI (Email + OTP)                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Filter Controls (Month, Quarter, Business Group)  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Univer Spreadsheet Display                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Export to Excel                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üï HTTP/JSON
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               FastAPI Backend (Python)                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  API Endpoints:                                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - POST /auth/send-otp                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - POST /auth/verify-otp                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - POST /api/report/generate                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - GET /api/filters/options                         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Data Processing (Pandas):                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Load CSV files                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Filter data by criteria                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Calculate EBIT, EBITDA, Common Size              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Create crosstab structure                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Convert to Univer snapshot format                ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üï
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     Data Storage                             ‚îÇ
‚îÇ  - profit_loss.csv (main data)                              ‚îÇ
‚îÇ  - other_income_expense.csv (month, ytd)                    ‚îÇ
‚îÇ  - user_whitelist.json (allowed email domains)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### 1. ‡πÑ‡∏ü‡∏•‡πå CSV ‡∏´‡∏•‡∏±‡∏Å (profit_loss.csv)
```
Columns:
- YEAR, MONTH, DATE
- PRODUCT_KEY, PRODUCT_NAME
- BUSINESS_GROUP, SERVICE_GROUP, BUSINESS, SERVICE, PRODUCT
- ‡∏´‡∏°‡∏ß‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (Account Category)
- TYPE (02 ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£, 03 ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢‡∏Ø, 04 ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô)
- EXPENSE_VALUE, AMOUNT, REVENUE_VALUE
```

### 2. ‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ/‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô (other_income_expense.csv)
```
Columns:
- YEAR, MONTH
- other_income_month, other_income_ytd
- other_expense_month, other_expense_ytd
- financial_cost_month, financial_cost_ytd
```

### 3. ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (Crosstab)
**Rows** (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 50+ ‡πÅ‡∏ñ‡∏ß):
1. ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à 7 ‡∏Å‡∏•‡∏∏‡πà‡∏°)
2. ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ç‡∏≤‡∏¢ (14 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
3. ‡∏Å‡∏≥‡πÑ‡∏£‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏ô
4. ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î (10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
5. ‡∏Å‡∏≥‡πÑ‡∏£‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢
6. ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (11 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
7. EBIT, EBITDA
8. ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏∑‡πà‡∏ô, ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô
9. EBT, ‡∏†‡∏≤‡∏©‡∏µ, ‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥
10. ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ (Common Size)

**Columns** (‡πÅ‡∏ö‡∏ö Dynamic):
- ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:
  - ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (Jan, Feb, ..., Dec)
  - ‡∏™‡∏∞‡∏™‡∏° (Jan YTD, Feb YTD, ...)
  - ‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™ (Q1, Q2, Q3, Q4)
  - ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
  - ‡∏ï‡∏≤‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à/‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£

---

## üéØ Phase 1: Project Setup (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1-2)

### 1.1 ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Project
```bash
univer/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py                    # FastAPI app
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py                  # Configuration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/                    # Pydantic models
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ report.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ filters.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routers/                   # API routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ report.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/                  # Business logic
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data_loader.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ report_calculator.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ univer_converter.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ email_sender.py
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ otp_generator.py
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profit_loss.csv
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ other_income_expense.csv
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user_whitelist.json
‚îÇ   ‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îî‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Auth/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginForm.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OTPVerification.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Filters/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MonthSelector.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QuarterSelector.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BusinessGroupSelector.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FilterPanel.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Report/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UniverReport.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ExportButton.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Layout/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Header.tsx
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Sidebar.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authService.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reportService.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ report.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ univer.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAuth.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useReport.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ univerHelper.ts
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ   ‚îú‚îÄ‚îÄ vite.config.ts
‚îÇ   ‚îî‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ API.md
‚îÇ   ‚îú‚îÄ‚îÄ DATA_STRUCTURE.md
‚îÇ   ‚îî‚îÄ‚îÄ DEPLOYMENT.md
‚îú‚îÄ‚îÄ PROJECT_PLAN.md
‚îî‚îÄ‚îÄ README.md
```

### 1.2 ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Dependencies

**Backend (requirements.txt)**:
```
fastapi==0.109.0
uvicorn[standard]==0.27.0
pandas==2.2.0
pydantic==2.5.0
pydantic-settings==2.1.0
python-dotenv==1.0.0
python-jose[cryptography]==3.3.0
passlib==1.7.4
python-multipart==0.0.6
aiosmtplib==3.0.1
openpyxl==3.1.2
```

**Frontend (package.json)**:
```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@univerjs/core": "^0.1.0",
    "@univerjs/design": "^0.1.0",
    "@univerjs/docs": "^0.1.0",
    "@univerjs/docs-ui": "^0.1.0",
    "@univerjs/engine-formula": "^0.1.0",
    "@univerjs/engine-render": "^0.1.0",
    "@univerjs/sheets": "^0.1.0",
    "@univerjs/sheets-formula": "^0.1.0",
    "@univerjs/sheets-ui": "^0.1.0",
    "@univerjs/ui": "^0.1.0",
    "axios": "^1.6.5",
    "antd": "^5.13.0"
  }
}
```

---

## üéØ Phase 2: Backend Development (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 3-7)

### 2.1 Authentication System (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 3)
- [ ] Email domain validation
- [ ] OTP generation (6 digits, expire 5 minutes)
- [ ] OTP email sending
- [ ] Session management (JWT token)
- [ ] API endpoints:
  - `POST /auth/send-otp` - ‡∏™‡πà‡∏á OTP ‡πÑ‡∏õ email
  - `POST /auth/verify-otp` - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö OTP ‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å JWT token
  - `POST /auth/logout` - ‡∏•‡∏ö session

### 2.2 Data Loading & Processing (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 4-5)
- [ ] CSV file reader (pandas)
- [ ] Data validation
- [ ] Mapping columns ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
- [ ] Cache mechanism ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö data ‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß

### 2.3 Report Calculator (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 6-7)
‡∏™‡∏£‡πâ‡∏≤‡∏á service ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ‡πÇ‡∏î‡∏¢‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô:

#### 2.3.1 Revenue Calculation
```python
def calculate_revenue(df, filters):
    """
    ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à
    - ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
    - ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ô‡∏ï‡∏ö‡∏£‡∏≠‡∏î‡πÅ‡∏ö‡∏ô‡∏î‡πå
    - ... (7 ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
    """
```

#### 2.3.2 Cost Calculation
```python
def calculate_cost_of_service(df, filters):
    """
    ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (TYPE = '02 ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£')
    ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:
    - C01 ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô
    - C02 ‡∏Ñ‡πà‡∏≤‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£
    - ... (14 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
    """

def calculate_selling_expense(df, filters):
    """
    ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î (TYPE = '03 ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î')
    """

def calculate_admin_expense(df, filters):
    """
    ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (TYPE = '04 ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô')
    """
```

#### 2.3.3 Profit Calculation
```python
def calculate_gross_profit(revenue, cost_of_service):
    """‡∏Å‡∏≥‡πÑ‡∏£‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏ô = ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£"""

def calculate_ebit(gross_profit, selling_exp, admin_exp):
    """EBIT = ‡∏Å‡∏≥‡πÑ‡∏£‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏ô - ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≤‡∏¢ - ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£"""

def calculate_ebitda(ebit, depreciation, amortization):
    """EBITDA = EBIT + Depreciation + Amortization"""

def calculate_ebt(ebit, other_income, other_expense, financial_cost):
    """EBT = EBIT + ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏∑‡πà‡∏ô - ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô"""
```

#### 2.3.4 Common Size Calculation
```python
def calculate_common_size(amount, base_revenue):
    """
    ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ
    Common Size % = (amount / revenue) * 100
    """
```

#### 2.3.5 Crosstab Creation
```python
def create_crosstab(df, row_structure, col_filters):
    """
    ‡∏™‡∏£‡πâ‡∏≤‡∏á crosstab ‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    - rows: ‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô P&L
    - columns: ‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™/‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à)
    """
```

### 2.4 Univer Snapshot Converter (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 7)
```python
def convert_to_univer_snapshot(df_report, formatting_rules):
    """
    ‡πÅ‡∏õ‡∏•‡∏á DataFrame ‡πÄ‡∏õ‡πá‡∏ô Univer snapshot format
    - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ, ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤, ‡∏Ç‡∏µ‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ
    - Merge cells ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö header
    - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î number format (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô, ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå)
    - ‡∏™‡∏£‡πâ‡∏≤‡∏á formula ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì

    Returns:
    {
        "id": "workbook-01",
        "name": "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô",
        "sheets": {
            "sheet-01": {
                "name": "P&L Report",
                "cellData": {...},
                "rowData": {...},
                "columnData": {...}
            }
        },
        "styles": {...}
    }
    """
```

### 2.5 API Endpoints (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 7)

#### Report Generation API
```python
@router.post("/api/report/generate")
async def generate_report(
    filters: ReportFilters,
    current_user: User = Depends(get_current_user)
):
    """
    Input (ReportFilters):
    {
        "months": [1, 2, 3],          // ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        "year": 2025,
        "view_type": "monthly",        // monthly, quarterly, yearly
        "display_type": "actual_ytd",  // actual, ytd, both
        "business_groups": [],         // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô [] = all
        "service_groups": [],
        "services": [],
        "show_common_size": true
    }

    Output:
    {
        "snapshot": {...},             // Univer snapshot
        "metadata": {
            "generated_at": "2025-01-22T...",
            "filters_applied": {...},
            "total_rows": 50,
            "total_columns": 12
        }
    }
    """
```

#### Filter Options API
```python
@router.get("/api/filters/options")
async def get_filter_options():
    """
    ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö filter

    Output:
    {
        "years": [2023, 2024, 2025],
        "business_groups": [
            {"id": "1", "name": "‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô"},
            {"id": "2", "name": "‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ó‡∏µ‡πà‡∏Ø"},
            ...
        ],
        "service_groups": [...],
        "services": [...]
    }
    """
```

---

## üéØ Phase 3: Frontend Development (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 8-12)

### 3.1 Authentication UI (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 8)
- [ ] LoginForm component (‡∏Å‡∏£‡∏≠‡∏Å email)
  - Validate email domain
  - ‡πÅ‡∏™‡∏î‡∏á error message
- [ ] OTPVerification component
  - Input OTP (6 digits)
  - Countdown timer (5 minutes)
  - Resend OTP button
- [ ] Protected route wrapper

### 3.2 Filter Panel (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 9)
- [ ] MonthSelector (multi-select checkbox)
- [ ] QuarterSelector (Q1, Q2, Q3, Q4 buttons)
- [ ] YearSelector (dropdown)
- [ ] ViewTypeSelector (radio: ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™/‡∏õ‡∏µ)
- [ ] DisplayTypeSelector (radio: ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏™‡∏∞‡∏™‡∏°/‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà)
- [ ] BusinessGroupSelector (tree select)
- [ ] CommonSizeToggle (switch: ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô %)
- [ ] "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô" button

### 3.3 Univer Integration (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 10-11)

#### UniverReport Component
```typescript
interface UniverReportProps {
  snapshot: IWorkbookData;
  onExport?: () => void;
}

const UniverReport: React.FC<UniverReportProps> = ({ snapshot, onExport }) => {
  const univerRef = useRef<HTMLDivElement>(null);
  const [univer, setUniver] = useState<Univer | null>(null);

  useEffect(() => {
    // Initialize Univer
    const univerInstance = createUniver({
      locale: LocaleType.TH_TH,
      locales: { ... },
      presets: [
        UniverSheetsCorePreset({
          container: univerRef.current!,
        }),
      ],
    });

    // Load snapshot
    univerInstance.univerAPI.createWorkbook(snapshot);

    setUniver(univerInstance);

    return () => {
      univerInstance.dispose();
    };
  }, [snapshot]);

  return (
    <div className="univer-container">
      <div ref={univerRef} style={{ height: '100vh' }} />
      <ExportButton onClick={onExport} />
    </div>
  );
};
```

### 3.4 Export Functionality (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 11)
```typescript
const exportToExcel = async (univerAPI: FUniver) => {
  // ‡πÉ‡∏ä‡πâ Univer API ‡πÄ‡∏û‡∏∑‡πà‡∏≠ export ‡πÄ‡∏õ‡πá‡∏ô .xlsx
  const workbook = univerAPI.getActiveWorkbook();
  const blob = await workbook.save();

  // Download file
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô_${new Date().toISOString()}.xlsx`;
  a.click();
};
```

### 3.5 Layout & UI Polish (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 12)
- [ ] Header (logo, user info, logout button)
- [ ] Sidebar (collapsible filter panel)
- [ ] Loading states
- [ ] Error handling & toast notifications
- [ ] Responsive design

---

## üéØ Phase 4: Advanced Features (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 13-15)

### 4.1 Row/Column Grouping (Collapse/Expand) (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 13)
‡πÉ‡∏ô Univer ‡πÉ‡∏ä‡πâ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå Row/Column Grouping:
```typescript
// ‡∏™‡∏£‡πâ‡∏≤‡∏á group ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (rows 2-9)
univerAPI.executeCommand({
  id: 'sheet.command.set-row-group',
  params: {
    startRow: 2,
    endRow: 9,
    level: 1,
  },
});

// ‡∏™‡∏£‡πâ‡∏≤‡∏á group ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (rows 11-24)
univerAPI.executeCommand({
  id: 'sheet.command.set-row-group',
  params: {
    startRow: 11,
    endRow: 24,
    level: 1,
  },
});
```

### 4.2 Conditional Formatting (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 13)
- ‡πÅ‡∏ñ‡∏ß‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å (‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ, ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô): ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏°, ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤
- ‡πÅ‡∏ñ‡∏ß‡∏£‡∏≤‡∏¢‡∏¢‡πà‡∏≠‡∏¢: ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß
- ‡πÅ‡∏ñ‡∏ß‡∏ú‡∏•‡∏£‡∏ß‡∏° (‡∏Å‡∏≥‡πÑ‡∏£‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏ô, EBIT, EBT): ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡πà‡∏≠‡∏ô, ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤, ‡∏Ç‡∏µ‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ
- ‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏•‡∏ö: ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏µ‡πÅ‡∏î‡∏á
- Common Size %: ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô

### 4.3 Number Formatting (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 14)
```python
def get_cell_format(cell_type, value):
    formats = {
        "currency": {
            "pattern": "#,##0.00",
            "prefix": "",
            "suffix": ""
        },
        "percentage": {
            "pattern": "0.00%",
        },
        "integer": {
            "pattern": "#,##0",
        }
    }
    return formats.get(cell_type)
```

### 4.4 MCP Server Integration (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 14-15)

#### ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á MCP SDK
```bash
pip install mcp
```

#### ‡∏™‡∏£‡πâ‡∏≤‡∏á MCP Server
```python
# backend/mcp_server/server.py
from mcp import MCPServer, Tool

server = MCPServer("univer-report-server")

@server.tool()
async def get_report_data(filters: dict) -> dict:
    """
    MCP Tool ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
    ‡πÉ‡∏´‡πâ AI Agent ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
    """
    # Logic ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö API endpoint
    result = await generate_report(filters)
    return result

@server.tool()
async def get_filter_options() -> dict:
    """
    MCP Tool ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å filter
    """
    options = await load_filter_options()
    return options

if __name__ == "__main__":
    server.run()
```

#### ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô MCP
User ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ AI Agent (‡πÄ‡∏ä‡πà‡∏ô Claude Desktop) ‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö:
```
User: "‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2025 ‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à Fixed Line"
AI Agent -> ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å MCP Tool get_report_data() -> ‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
```

---

## üéØ Phase 5: Testing & Optimization (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 16-18)

### 5.1 Unit Testing (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 16)
**Backend Tests**:
```python
# tests/test_report_calculator.py
def test_calculate_revenue():
    df = load_test_data()
    result = calculate_revenue(df, filters={...})
    assert result['total'] == expected_value

def test_calculate_ebit():
    # Test EBIT calculation
    ...

def test_calculate_common_size():
    # Test percentage calculation
    ...
```

**Frontend Tests**:
```typescript
// src/components/Filters/__tests__/MonthSelector.test.tsx
describe('MonthSelector', () => {
  it('should select multiple months', () => {
    // Test logic
  });
});
```

### 5.2 Integration Testing (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 17)
- [ ] Test API endpoints
- [ ] Test authentication flow
- [ ] Test report generation with various filters
- [ ] Test export functionality

### 5.3 Performance Optimization (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 17-18)
- [ ] Add caching (Redis) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö report ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß
- [ ] Optimize pandas operations (use vectorization)
- [ ] Add pagination/lazy loading ‡∏ñ‡πâ‡∏≤ report ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å
- [ ] Optimize Univer rendering (virtual scrolling)

### 5.4 User Acceptance Testing (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 18)
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö real users
- [ ] ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏° feedback
- [ ] ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏≤‡∏° feedback

---

## üéØ Phase 6: Deployment (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 19-20)

### 6.1 Backend Deployment
**Option 1: Docker**
```dockerfile
# Dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY ./app ./app
COPY ./data ./data

CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**Option 2: Cloud Run / AWS Lambda**

### 6.2 Frontend Deployment
**Build for production**:
```bash
npm run build
```

**Deploy to**:
- Vercel
- Netlify
- AWS S3 + CloudFront

### 6.3 Environment Configuration
```bash
# .env.production
DATABASE_URL=...
SMTP_SERVER=...
SMTP_PORT=587
SMTP_USERNAME=...
SMTP_PASSWORD=...
JWT_SECRET=...
ALLOWED_EMAIL_DOMAINS=company.com,company.co.th
```

---

## üìù ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÅ‡∏•‡∏∞ Best Practices

### Data Processing
1. **‡πÉ‡∏ä‡πâ pandas ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û**:
   - ‡πÉ‡∏ä‡πâ `.groupby()` ‡πÅ‡∏ó‡∏ô loop
   - ‡πÉ‡∏ä‡πâ `.query()` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö filter
   - ‡πÉ‡∏ä‡πâ `.pivot_table()` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö crosstab

2. **Handle missing data**:
   - ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏´‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏™‡∏î‡∏á 0 ‡∏´‡∏£‡∏∑‡∏≠ "-"
   - ‡∏Å‡∏£‡∏ì‡∏µ division by zero ‡πÉ‡∏ô Common Size

3. **Validate data**:
   - Check data types
   - Check required columns exist
   - Check date ranges

### Univer Integration
1. **Performance**:
   - ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á snapshot ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÄ‡∏Å‡∏¥‡∏ô 10,000 ‡πÄ‡∏ã‡∏•‡∏•‡πå
   - ‡πÉ‡∏ä‡πâ lazy loading ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏¢‡∏≠‡∏∞

2. **Styling**:
   - ‡∏™‡∏£‡πâ‡∏≤‡∏á style library ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥
   - ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î style ‡πÅ‡∏ö‡∏ö inline ‡∏ó‡∏∏‡∏Å cell

3. **Formula**:
   - ‡πÉ‡∏ä‡πâ formula ‡πÉ‡∏ô Univer ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏µ‡πà user ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
   - ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏à‡∏≤‡∏Å backend ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### Security
1. **Authentication**:
   - OTP expire ‡∏´‡∏•‡∏±‡∏á 5 ‡∏ô‡∏≤‡∏ó‡∏µ
   - ‡∏à‡∏≥‡∏Å‡∏±‡∏î rate limit (‡∏™‡πà‡∏á OTP ‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)
   - ‡πÉ‡∏ä‡πâ HTTPS ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

2. **Data Access**:
   - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö email domain ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á OTP
   - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö JWT token ‡∏ó‡∏∏‡∏Å request
   - ‡πÑ‡∏°‡πà expose sensitive data ‡πÉ‡∏ô API response

---

## üìä Timeline Summary

| Phase | Duration | Tasks |
|-------|----------|-------|
| Phase 1: Setup | 2 days | Project structure, dependencies |
| Phase 2: Backend | 5 days | Auth, data processing, API |
| Phase 3: Frontend | 5 days | UI components, Univer integration |
| Phase 4: Advanced | 3 days | Grouping, formatting, MCP |
| Phase 5: Testing | 3 days | Unit/integration tests, optimization |
| Phase 6: Deployment | 2 days | Docker, cloud deployment |
| **Total** | **20 days** | |

---

## üéØ Success Criteria

- [ ] User ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ login ‡∏î‡πâ‡∏ß‡∏¢ email + OTP ‡πÑ‡∏î‡πâ
- [ ] User ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å filter ‡πÑ‡∏î‡πâ (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, ‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™, ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à)
- [ ] ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô Univer ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Excel
- [ ] ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì EBIT, EBITDA, Common Size ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- [ ] User ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ export ‡πÄ‡∏õ‡πá‡∏ô Excel ‡πÑ‡∏î‡πâ
- [ ] User ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏´‡∏∏‡∏ö/‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ
- [ ] ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö MCP Server
- [ ] Response time < 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô

---

## üìö ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

- [Univer Documentation](https://univer.ai/docs)
- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [Pandas Documentation](https://pandas.pydata.org/docs/)
- [React Documentation](https://react.dev/)
- [MCP SDK](https://github.com/anthropics/model-context-protocol)
