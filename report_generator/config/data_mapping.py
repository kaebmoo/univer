"""
Data Mapping Configuration
Maps row labels to CSV GROUP/SUB_GROUP structure
"""

# Mapping between report row labels and CSV GROUP/SUB_GROUP
# Format: {row_label: (GROUP, SUB_GROUP)}
# SUB_GROUP can be None if it's a total row

ROW_TO_CSV_MAPPING = {
    # 1. รายได้ (Revenue) - มีข้อมูลจริงในไฟล์
    "1.รายได้": ("01.รายได้", None),  # Total of all revenue sub-groups
    "- รายได้กลุ่มธุรกิจโครงสร้างพื้นฐาน": ("01.รายได้", "01.รายได้กลุ่มธุรกิจโครงสร้างพื้นฐาน"),
    "- รายได้กลุ่มธุรกิจโทรศัพท์ประจำที่และอินเตอร์เนตบรอดแบนด์": ("01.รายได้", "02.รายได้กลุ่มธุรกิจโทรศัพท์ประจำที่และอินเตอร์เนตบรอดแบนด์"),
    "- รายได้กลุ่มธุรกิจโทรศัพท์เคลื่อนที่": ("01.รายได้", "03.รายได้กลุ่มธุรกิจโทรศัพท์เคลื่อนที่"),
    "- รายได้กลุ่มธุรกิจวงจรระหว่างประเทศ": ("01.รายได้", "04.รายได้กลุ่มธุรกิจวงจรระหว่างประเทศ"),
    "- รายได้กลุ่มธุรกิจดิจิทัล": ("01.รายได้", "05.รายได้กลุ่มธุรกิจดิจิทัล"),
    "- รายได้กลุ่มธุรกิจ ICT Solution Business": ("01.รายได้", "06.รายได้กลุ่มธุรกิจ ICT SOLUTION BUSINESS"),
    "- รายได้จากการให้บริการอื่นที่ไม่ใช่โทรคมนาคม": ("01.รายได้", "08.รายได้จากการให้บริการอื่นที่ไม่ใช่โทรคมนาคม"),
    "- รายได้จากการขาย": ("01.รายได้", "09.รายได้จากการขาย"),

    # 2. ต้นทุนบริการและต้นทุนขาย (Cost of Service) - มีข้อมูลจริงในไฟล์
    "2.ต้นทุนบริการและต้นทุนขาย :": ("02.ต้นทุนบริการและต้นทุนขาย :", None),
    "- ค่าใช้จ่ายตอบแทนแรงงาน": ("02.ต้นทุนบริการและต้นทุนขาย :", "01.ค่าใช้จ่ายตอบแทนแรงงาน"),
    "- ค่าสวัสดิการ": ("02.ต้นทุนบริการและต้นทุนขาย :", "03.ค่าสวัสดิการ"),
    "- ค่าใช้จ่ายพัฒนาและฝึกอบรมบุคลากร": ("02.ต้นทุนบริการและต้นทุนขาย :", "04.ค่าใช้จ่ายพัฒนาและฝึกอบรมบุคลากร"),
    "- ค่าซ่อมแซมและบำรุงรักษาและวัสดุใช้ไป": ("02.ต้นทุนบริการและต้นทุนขาย :", "05.ค่าซ่อมแซมและบำรุงรักษาและวัสดุใช้ไป"),
    "- ค่าสาธารณูปโภค": ("02.ต้นทุนบริการและต้นทุนขาย :", "06.ค่าสาธารณูปโภค"),
    "- ค่าใช้จ่ายเกี่ยวกับการกำกับดูแลของ กสทช.": ("02.ต้นทุนบริการและต้นทุนขาย :", "09.ค่าใช้จ่ายเกี่ยวกับการกำกับดูแลของ กสทช."),
    "- ค่าส่วนแบ่งบริการโทรคมนาคม": ("02.ต้นทุนบริการและต้นทุนขาย :", "10.ค่าส่วนแบ่งบริการโทรคมนาคม"),
    "- ค่าใช้จ่ายบริการโทรคมนาคม": ("02.ต้นทุนบริการและต้นทุนขาย :", "11.ค่าใช้จ่ายบริการโทรคมนาคม"),
    "- ค่าเสื่อมราคาและรายจ่ายตัดบัญชีสินทรัพย์": ("02.ต้นทุนบริการและต้นทุนขาย :", "12.ค่าเสื่อมราคาและรายจ่ายตัดบัญชีสินทรัพย์"),
    "- ค่าตัดจำหน่ายสิทธิการใช้ตามสัญญาเช่า": ("02.ต้นทุนบริการและต้นทุนขาย :", "13.ค่าตัดจำหน่ายสิทธิการใช้ตามสัญญาเช่า"),
    "- ค่าเช่าและค่าใช้สินทรัพย์": ("02.ต้นทุนบริการและต้นทุนขาย :", "14.ค่าเช่าและค่าใช้สินทรัพย์"),
    "- ต้นทุนขาย": ("02.ต้นทุนบริการและต้นทุนขาย :", "15.ต้นทุนขาย"),
    "- ค่าใช้จ่ายบริการอื่น": ("02.ต้นทุนบริการและต้นทุนขาย :", "16.ค่าใช้จ่ายบริการอื่น"),
    "- ค่าใช้จ่ายดำเนินงานอื่น": ("02.ต้นทุนบริการและต้นทุนขาย :", "17.ค่าใช้จ่ายดำเนินงานอื่น"),

    # 3. กำไรขั้นต้น - คำนวณมาแล้วในไฟล์!
    "3.กำไร(ขาดทุน)ขั้นต้นจากการดำเนินงาน (1) - (2)": ("03.กำไร(ขาดทุน)ขั้นต้นจากการดำเนินงาน (1) - (2)", "03.กำไร(ขาดทุน)ขั้นต้นจากการดำเนินงาน (1) - (2)"),

    # 4. ค่าใช้จ่ายขายและการตลาด
    "4.ค่าใช้จ่ายขายและการตลาด :": ("04.ค่าใช้จ่ายขายและการตลาด :", None),
    # Sub-items for selling expense (will be mapped to specific SUB_GROUP)

    # 5. กำไรหลังหักค่าใช้จ่ายขาย - คำนวณมาแล้วในไฟล์!
    "5.กำไร(ขาดทุน)หลังหักค่าใช้จ่ายขายและการตลาด (3) - (4)": ("05.กำไร(ขาดทุน)หลังหักค่าใช้จ่ายขายและการตลาด (3) - (4)", "05.กำไร(ขาดทุน)หลังหักค่าใช้จ่ายขายและการตลาด (3) - (4)"),

    # 6. ค่าใช้จ่ายบริหาร
    "6.ค่าใช้จ่ายบริหารและสนับสนุน :": ("06.ค่าใช้จ่ายบริหารและสนับสนุน :", None),

    # 7. ต้นทุนทางการเงิน-ด้านการดำเนินงาน
    "7.ต้นทุนทางการเงิน-ด้านการดำเนินงาน": ("07.ต้นทุนทางการเงิน-ด้านการดำเนินงาน", "07.ต้นทุนทางการเงิน-ด้านการดำเนินงาน"),

    # 8. EBIT - คำนวณมาแล้วในไฟล์!
    "8.กำไร(ขาดทุน)ก่อนต้นทุนจัดหาเงิน รายได้อื่นและค่าใช้จ่ายอื่น (5) - (6) - (7)": ("08.กำไร(ขาดทุน)ก่อนต้นทุนจัดหาเงิน รายได้อื่นและค่าใช้จ่ายอื่น (5) - (6) - (7)", "08.กำไร(ขาดทุน)ก่อนต้นทุนจัดหาเงิน รายได้อื่นและค่าใช้จ่ายอื่น (5) - (6) - (7)"),

    # 9. ผลตอบแทนทางการเงินและรายได้อื่น
    "9.ผลตอบแทนทางการเงินและรายได้อื่น": ("09.ผลตอบแทนทางการเงินและรายได้อื่น", "09.ผลตอบแทนทางการเงินและรายได้อื่น"),

    # 10. ค่าใช้จ่ายอื่น
    "10.ค่าใช้จ่ายอื่น": ("10.ค่าใช้จ่ายอื่น", "10.ค่าใช้จ่ายอื่น"),

    # 11. ต้นทุนทางการเงิน-ด้านการจัดหาเงิน (อาจจะไม่มีในไฟล์บางเดือน)
    "11.ต้นทุนทางการเงิน-ด้านการจัดหาเงิน": ("11.ต้นทุนทางการเงิน-ด้านการจัดหาเงิน", "11.ต้นทุนทางการเงิน-ด้านการจัดหาเงิน"),

    # 12. EBT - คำนวณมาแล้วในไฟล์!
    "12.กำไร(ขาดทุน)ก่อนหักภาษีเงินได้ (EBT) (8) + (9) - (10) - (11)": ("12.กำไร(ขาดทุน)ก่อนหักภาษีเงินได้ (EBT) (8) + (9) - (10) - (11)", "12.กำไร(ขาดทุน)ก่อนหักภาษีเงินได้ (EBT) (8) + (9) - (10) - (11)"),

    # 13. ภาษีเงินได้ (อาจจะไม่มีในไฟล์บางเดือน)
    "13.ภาษีเงินได้นิติบุคคล": ("13.ภาษีเงินได้นิติบุคคล", "13.ภาษีเงินได้นิติบุคคล"),

    # 14. กำไรสุทธิ - คำนวณมาแล้วในไฟล์!
    "14.กำไร(ขาดทุน) สุทธิ (12) - (13)": ("14.กำไร(ขาดทุน) สุทธิ (12) - (13)", "14.กำไร(ขาดทุน) สุทธิ (12) - (13)"),
}

# Rows that need to be calculated (not in CSV)
CALCULATED_ROWS = {
    "รายได้รวม": "sum_revenue",  # Sum of all revenue (GROUP = 01)
    "ค่าใช้จ่ายรวม (ไม่รวมต้นทุนทางการเงิน)": "sum_expense_no_finance",  # Sum of 02, 04, 06
    "ค่าใช้จ่ายรวม (รวมต้นทุนทางการเงิน)": "sum_expense_with_finance",  # Sum of 02, 04, 06, 07, 11
    "EBITDA": "ebitda",  # EBIT + depreciation + amortization
    "รายได้บริการ": "service_revenue",  # Revenue excluding other income
    "     1. ต้นทุนบริการรวม": "total_service_cost",  # GROUP = 02 total
    "     2. ต้นทุนบริการ - ค่าเสื่อมราคาฯ": "service_cost_no_depreciation",
    "     3. ต้นทุนบริการ - ไม่รวมค่าใช้จ่ายบุคลากรและค่าเสื่อมราคาฯ": "service_cost_no_personnel_depreciation",
}

# Special handling for ratio rows that have context-dependent calculation
RATIO_ROW_LABEL = "         สัดส่วนต่อรายได้"

# Categories for depreciation (used in EBITDA calculation)
DEPRECIATION_CATEGORIES = [
    "12.ค่าเสื่อมราคาและรายจ่ายตัดบัญชีสินทรัพย์",
    "13.ค่าตัดจำหน่ายสิทธิการใช้ตามสัญญาเช่า",
]

# Categories for personnel costs
PERSONNEL_CATEGORIES = [
    "01.ค่าใช้จ่ายตอบแทนแรงงาน",
    "03.ค่าสวัสดิการ",
    "04.ค่าใช้จ่ายพัฒนาและฝึกอบรมบุคลากร",
]


def get_group_sub_group(row_label: str) -> tuple:
    """
    Get GROUP and SUB_GROUP for a row label

    Args:
        row_label: Row label from ROW_ORDER

    Returns:
        Tuple of (GROUP, SUB_GROUP) or (None, None) if calculated row
    """
    if row_label in ROW_TO_CSV_MAPPING:
        return ROW_TO_CSV_MAPPING[row_label]
    elif row_label in CALCULATED_ROWS:
        return (None, None)  # Calculated row
    else:
        return (None, None)  # Unknown row


def is_calculated_row(row_label: str) -> bool:
    """Check if row needs to be calculated (not in CSV)"""
    return row_label in CALCULATED_ROWS


def get_calculation_type(row_label: str) -> str:
    """Get calculation type for calculated rows"""
    return CALCULATED_ROWS.get(row_label, None)
