**กรอบแนวคิด (Framework)** และ **วิธีการ (Methodology)** ในการตรวจสอบเพื่อสร้างความเชื่อมั่น (Assurance) และการกระทบยอด (Reconciliation)

---

### **หลักการสำคัญ (Key Principles)**

ในการตรวจสอบรายงานทางการเงินที่ประมวลผลมาจากข้อมูลดิบ หลักการที่สำคัญที่สุด 3 ประการคือ:

1.  **ความครบถ้วน (Completeness):** ข้อมูลที่นำเข้ามา (Input) ทั้งหมด จะต้องถูกนำไปแสดงผลในรายงาน (Output) อย่างครบถ้วน ไม่หายไประหว่างทาง (Sum Input = Sum Output)
2.  **ความถูกต้องของการจัดประเภท (Classification Accuracy):** ตัวเลขเดียวกัน เมื่อมองในมุมมองที่ต่างกัน (เช่น มองมุมต้นทุน vs มองมุมบัญชี) จะต้องมียอดรวมสุทธิเท่ากันเสมอ
3.  **ความมีอยู่จริงและตรงกับบัญชีหลัก (Existence & Tie-out):** รายงานที่สร้างขึ้น (Excel) จะต้องตรงกับ "แหล่งความจริงหนึ่งเดียว" (Single Source of Truth) ซึ่งในที่นี้คือ งบการเงินจากระบบบัญชี (ไฟล์ Text/GL)

---

### **วิธีการและขั้นตอนการทำ (Step-by-Step Methodology)**

เราจะแบ่งการตรวจสอบออกเป็น 3 ระดับ (Layers) ดังนี้ครับ:

#### **ระดับที่ 1: ตรวจสอบความครบถ้วนของข้อมูล (Source to Report Verification)**
เป็นการเช็คว่า "ข้อมูลดิบ (CSV)" ถูกกวาดมารวมใน "รายงาน (Excel)" ครบหรือไม่

* **สิ่งที่ต้องทำ:**
    * หา **Control Total** (ผลรวมยอดควบคุม) ของไฟล์ CSV ต้นฉบับ (แยกตามไฟล์ Cost Type และ GL Group)
    * หา **Grand Total** (ผลรวมทั้งสิ้น) ของไฟล์ Excel รายงานที่สร้างเสร็จแล้ว
* **สมการตรวจสอบ:**
    $$\sum (\text{Value in CSV}) = \sum (\text{Grand Total in Excel Report})$$
* **จุดที่ต้องเน้น:** เช็คยอด "รายได้รวม", "ค่าใช้จ่ายรวม", และ "กำไรสุทธิ"

#### **ระดับที่ 2: ตรวจสอบความสัมพันธ์ข้ามมิติ (Cross-Dimensional Consistency)**
เนื่องจากรายงานของคุณมี 2 มิติ คือ "ประเภทต้นทุน (Cost Type)" และ "หมวดบัญชี (GL Group)" ทั้งสองไฟล์นี้คือ *เรื่องเดียวกันแต่มองคนละมุม* ดังนั้นยอดสุดท้ายต้องเท่ากัน

* **สิ่งที่ต้องทำ:** เปรียบเทียบยอดสรุปของรายงานทั้ง 2 ประเภท
* **สมการตรวจสอบ:**
    $$\text{Net Profit (Cost Type Report)} = \text{Net Profit (GL Group Report)}$$
* **เหตุผล:** ถ้าไม่เท่ากัน แสดงว่ามี Mapping บางอย่างผิดพลาด หรือมีการดึงข้อมูลมาไม่พร้อมกัน

#### **ระดับที่ 3: การกระทบยอดกับงบการเงิน (Financial Statement Tie-out)**
นี่คือขั้นตอนที่สำคัญที่สุดเพื่อยืนยันว่ารายงานนี้ "เชื่อถือได้ทางบัญชี"

* **สิ่งที่ต้องทำ:** นำตัวเลขจากรายงาน Excel ไปเทียบกับไฟล์ **งบการเงิน (Text File)** ซึ่งเป็นงบทางการ
* **สมการตรวจสอบ:**
    $$\text{Net Profit (Excel Report)} = \text{กำไรสุทธิบรรทัดสุดท้าย (Text File)}$$
    $$\text{Total Revenue (Excel Report)} = \text{รวมรายได้ (Text File)}$$

---

### **ตารางสรุปจุดตรวจสอบ (Checkpoints Matrix)**

เพื่อให้เห็นภาพชัดเจนว่าต้องดึงค่าอะไรมาชนกับอะไร สรุปเป็นตารางให้ดังนี้ครับ:

| จุดตรวจสอบ (Check Point) | ข้อมูลฝั่งซ้าย (A) | ข้อมูลฝั่งขวา (B) | ผลลัพธ์ที่คาดหวัง |
| :--- | :--- | :--- | :--- |
| **1. รายได้ (Revenue)** | ผลรวมยอด Column `Value` ในไฟล์ CSV (กรองหมวดรายได้) | ยอดบรรทัด "รวมรายได้" ในไฟล์ Excel (Report) | **A = B** |
| **2. ค่าใช้จ่าย (Expense)** | ผลรวมยอด Column `Value` ในไฟล์ CSV (กรองหมวดค่าใช้จ่าย) | ยอดบรรทัด "รวมค่าใช้จ่าย" ในไฟล์ Excel (Report) | **A = B** |
| **3. กำไรสุทธิ (Net Profit)** | ผลรวมยอด Column `Value` ในไฟล์ CSV (รายได้ - ค่าใช้จ่าย) | ยอดบรรทัด "กำไร(ขาดทุน)สุทธิ" ในไฟล์ Excel (Report) | **A = B** |
| **4. ความสอดคล้อง (Consistency)** | กำไรสุทธิของรายงาน **"ประเภทต้นทุน"** | กำไรสุทธิของรายงาน **"หมวดบัญชี"** | **A = B** |
| **5. ความถูกต้อง (Validity)** | กำไรสุทธิในไฟล์ Excel (Report) | กำไรสุทธิในไฟล์ **Text (งบการเงิน)** | **A = B** |

---

### **สิ่งที่ต้องเตรียมสำหรับการเขียน Code ทดสอบ**

1.  **Data Cleaning:** ไฟล์ CSV และ Excel ของคุณมี Header หลายบรรทัด หรือมีบรรทัดว่าง ต้องเขียน Code ให้ข้ามบรรทัดเหล่านี้ไปอ่านเฉพาะบรรทัดที่เป็นข้อมูลจริง
2.  **Mapping Key:** ต้องระบุ Keyword สำคัญ เช่น คำว่า "กำไร(ขาดทุน)สุทธิ" หรือ "รายได้รวม" เพื่อให้โปรแกรมวิ่งไปหยิบตัวเลขถูกบรรทัด
3.  **Parsing Numbers:** ข้อมูลใน Text File และ Excel มักมีลูกน้ำ (,) หรือวงเล็บ `( )` แทนค่าลบ ต้องมีฟังก์ชันแปลงข้อความเหล่านี้ให้เป็นตัวเลขทศนิยม (Float) ก่อนนำมาคำนวณ

